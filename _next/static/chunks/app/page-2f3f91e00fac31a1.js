(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{2359:function(e,t,i){Promise.resolve().then(i.bind(i,8844))},8844:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return tb}});var n=i(7437),r=i(2265),s=i(7868);class o{async getAllAnnotations(){try{return await this.table.toArray()}catch(e){}}async getAnnotationsByBookId(e){try{return await this.table.where("bookId").equals(e).toArray()}catch(e){}}async getAnnotationById(e){try{return await this.table.get(e)}catch(e){}}async addAnnotation(e){try{return await this.table.add(e)}catch(e){}}async updateAnnotation(e,t){try{return await this.table.update(e,t)}catch(e){}}async deleteAnnotation(e){try{return await this.table.delete(e)}catch(e){}}constructor(e){this.table=e.table("annotationsTable")}}class a{async getLastReadRecord(e){try{return await this.table.get(e)}catch(e){}}setLastReadRecord(e,t){try{return this.table.put(e,t)}catch(e){}}constructor(e){this.table=e.table("lastReadTable")}}class l{async getSetting(e){try{var t;return null===(t=await this.table.get(e))||void 0===t?void 0:t.value}catch(e){}}async getAllSettings(){try{return(await this.table.toArray()).reduce((e,t)=>{let{key:i,value:n}=t;return{...e,[i]:n}},{})}catch(e){}}setSetting(e,t){try{return this.table.put({key:e,value:t})}catch(e){}}deleteSetting(e){try{return this.table.delete(e)}catch(e){}}constructor(e){this.table=e.table("settingsTable")}}class c extends s.ZP{constructor(){super("EvoReaderDB"),this.version(1).stores({lastReadTable:"filePath, bookId, updatedAt",settingsTable:"key",annotationsTable:"id, bookId"}),this.lastReadTable=new a(this),this.settingsTable=new l(this),this.annotationsTable=new o(this)}}let d=new c;var h=i(2063),u=i(6435);let p={settings:{fontsize:16,showSideBar:"",sidebarWidth:300,theme:"light",userContentStyle:"#evo-content {\n  font-size: 16px;\n  line-height: 1.6;\n  max-width: 34em;\n  padding-top: 1em;\n  padding-bottom: 2em;\n}"},isBookLoading:!1,showSideBar:"about",ebookUrl:"",ebookPath:"",ebookFileName:"",ebookSize:0,isMobile:!1,showMobilePage:""},f=r.createContext({readerProps:p,setReaderProps:()=>{}}),g=e=>{let{children:t}=e,[i,s]=(0,r.useState)(!1),[o,a]=(0,r.useState)(p);(0,r.useEffect)(()=>{d.settingsTable.getAllSettings().then(e=>{Object.keys(p.settings).forEach(t=>{e&&void 0!==e[t]||d.settingsTable.setSetting(t,p.settings[t])}),a(t=>({...t,settings:{...t.settings,...e}}))}).finally(()=>{s(!0)})},[]);let l=(0,h.Z)(o.settings);(0,r.useEffect)(()=>{if(!l||!i)return;let e=o.settings;Object.keys(e).forEach(t=>{l[t]!==e[t]&&d.settingsTable.setSetting(t,e[t])})},[o.settings,i]);let{setTheme:c}=(0,u.F)();(0,r.useEffect)(()=>{if(!i)return;let e=o.settings.theme;e&&c(e)},[i,o.settings.theme,c]),(0,r.useEffect)(()=>{async function e(e){let t=e[0],i=await t.getFile(),n=URL.createObjectURL(i),r=t.name;a(e=>({...e,ebookUrl:n,ebookPath:r,ebookFileName:r,ebookSize:i.size}))}window.electronApi&&window.electronApi.ipcRenderer.on("IPCWEB::FILE-OPENED",e=>{let{fileData:t,filePath:i,fileSize:n}=e,r=new Blob([t],{type:"application/epub+zip"}),s=URL.createObjectURL(r),o=e.filePath.split(/[/\\]/).pop()||"";a(e=>({...e,ebookUrl:s,ebookPath:i,ebookFileName:o,ebookSize:n}))}),"launchQueue"in window&&window.launchQueue.setConsumer(t=>{e(t.files)})},[]);let g=(0,r.useMemo)(()=>({readerProps:o,setReaderProps:a}),[o,a]);return(0,n.jsx)(f.Provider,{value:g,children:i&&t})};var v=i(5245),m=i.n(v),x=i(3571),b=i.n(x),w=i(4436);class y{async open(e){this.zipReader=new w.Mr(new w.Nt(e));let t=await this.zipReader.getEntries();this.entries=new Map(t.map(e=>[e.filename,e]))}async readEntry(e){var t;if(!this.entries)throw Error("Archive not opened");let i=null===(t=this.entries)||void 0===t?void 0:t.get(e);if(!i)throw Error("File not found in archive: ".concat(e));if(i.directory)throw Error("File is a directory: ".concat(e));if(!i.getData)throw Error("File cannot be read: ".concat(e));let n=new w.Ek;return await i.getData(n)}async createUrl(e){var t;if(!this.entries)throw Error("Archive not opened");let i=null===(t=this.entries)||void 0===t?void 0:t.get(e);if(!i)throw Error("File not found in archive: ".concat(e));if(i.directory)throw Error("File is a directory: ".concat(e));if(!i.getData)throw Error("File cannot be read: ".concat(e));let n=new w.U5,r=await i.getData(n);return URL.createObjectURL(r)}constructor(){this.zipReader=void 0,this.entries=void 0}}function j(e,t){let i;if(!e)throw Error("No Element Provided");return void 0!==e.querySelector?e.querySelector(t):(i=e.getElementsByTagName(t)).length?i[0]:null}function S(e,t){return void 0!==e.querySelector?e.querySelectorAll(t):e.getElementsByTagName(t)}function N(e,t,i){let n,r;if(void 0!==e.querySelector){for(let e in t+="[",i)t+=e+"~='"+i[e]+"'";return t+="]",e.querySelector(t)}if(n=e.getElementsByTagName(t),r=Array.prototype.slice.call(n,0).filter(function(e){for(let t in i)if(e.getAttribute(t)===i[t])return!0;return!1}))return r[0]}function C(e,t){let i=DOMParser;return 65279===e.charCodeAt(0)&&(e=e.slice(1)),new i().parseFromString(e,t)}function k(e,t){switch(m().extname(t)){case".xml":case".opf":case".ncx":default:return C(e,"text/xml");case".xhtml":return C(e,"application/xhtml+xml");case".html":case".htm":return C(e,"text/html")}}function T(e,t,i){let n=[],r=e.childNodes;for(let e=0;e<r.length;e++){let s=r[e];if(1===s.nodeType&&s.nodeName.toLowerCase()===t){if(i)return s;n.push(s)}}if(!i)return n}function E(e,t){let i;if(null!==e&&""!==t)for(i=e.parentNode;1===i.nodeType;){if(i.tagName.toLowerCase()===t)return i;i=i.parentNode}}function P(e){let t=[],i=e.childNodes;for(var n=0;n<i.length;n++){let e=i[n];1===e.nodeType&&t.push(e)}return t}class A{parse(e){var t;if(!e)throw Error("Container File Not Found");let i=j(e,"rootfile");if(!i)throw Error("No RootFile Found");this.opfPath=null!==(t=i.getAttribute("full-path"))&&void 0!==t?t:""}constructor(){this.encoding="",this.opfPath=""}}class R{checkType(e){return"string"==typeof e&&R.isCfiString(e)?"string":e&&"object"==typeof e&&("Range"===Object.prototype.toString.call(e).slice(8,-1)||void 0!==e.startContainer)?"range":e&&"object"==typeof e&&void 0!==e.nodeType?"node":!!e&&"object"==typeof e&&e instanceof R&&"EpubCFI"}parse(e){let t,i,n;if("string"!=typeof e)return{spinePos:-1};let r=R.extractCfi(e);return(t=R.getChapterComponent(r))?(this.baseParts=this.parseComponent(t),i=R.getPathComponent(r)||"",this.path=this.parseComponent(i),(n=this.getRange(r))&&(this.isRange=!0,this.start=this.parseComponent(n[0]),this.end=this.parseComponent(n[1])),this.spineIndex=this.baseParts.steps[1].index,this):{spinePos:-1}}parseComponent(e){let t;let i={steps:[],terminal:{offset:null,assertion:null}},n=e.split(":"),r=n[0].split("/");return n.length>1&&(t=n[1],i.terminal=this.parseTerminal(t)),""===r[0]&&r.shift(),i.steps=r.map(e=>this.parseStep(e)),i}parseStep(e){let t,i,n,r,s;return((r=e.match(/\[(.*)\]/))&&r[1]&&(s=r[1]),isNaN(i=parseInt(e)))?{type:"element",index:1,id:s||""}:(i%2==0?(t="element",n=i/2-1):(t="text",n=(i-1)/2),{type:t,index:n,id:s||""})}parseTerminal(e){var t;let i,n=null,r=e.match(/\[(.*)\]/);return r&&r[1]?(i=parseInt(e.split("[")[0]),n=r[1]):i=parseInt(e),!isNaN(parseFloat(t=i))&&isFinite(t)||(i=null),{offset:i,assertion:n}}static extractCfi(e){let t="";return 0===e.indexOf("epubcfi(")&&")"===e[e.length-1]&&(t=e.slice(8,e.length-1)),t}static getChapterComponent(e){return e.split("!")[0]}static getPathComponent(e){let t=e.split("!");if(t[1])return t[1].split(",")[0]}getRange(e){let t=e.split(",");if(3===t.length)return[t[1],t[2]]}getCharecterOffsetComponent(e){return e.split(":")[1]||""}joinSteps(e){return e?e.map(function(e){var t="";return"element"===e.type&&(t+=(e.index+1)*2),"text"===e.type&&(t+=1+2*e.index),e.id&&(t+="["+e.id+"]"),t}).join("/"):""}segmentString(e){var t="/";return t+=this.joinSteps(e.steps),e.terminal&&null!=e.terminal.offset&&(t+=":"+e.terminal.offset),e.terminal&&null!=e.terminal.assertion&&(t+="["+e.terminal.assertion+"]"),t}toString(){var e="epubcfi(";return e+=this.segmentString(this.baseParts)+"!"+this.segmentString(this.path),this.isRange&&this.start&&(e+=","+this.segmentString(this.start)),this.isRange&&this.end&&(e+=","+this.segmentString(this.end)),e+=")"}static compare(e,t){let i,n;if(i="string"==typeof e?new R(e):e,n="string"==typeof t?new R(t):t,i.spineIndex>n.spineIndex)return 1;if(i.spineIndex<n.spineIndex)return -1;i.isRange?(r=i.path.steps.concat((null===(l=i.start)||void 0===l?void 0:l.steps)||[]),o=null===(c=i.start)||void 0===c?void 0:c.terminal):(r=i.path.steps,o=i.path.terminal),n.isRange?(s=n.path.steps.concat((null===(d=n.start)||void 0===d?void 0:d.steps)||[]),a=null===(h=n.start)||void 0===h?void 0:h.terminal):(s=n.path.steps,a=n.path.terminal);for(var r,s,o,a,l,c,d,h,u=0;u<r.length;u++){if(!r[u])return -1;if(!s[u]||r[u].index>s[u].index)return 1;if(r[u].index<s[u].index)return -1}if(r.length<s.length)return -1;if((null==o?void 0:o.offset)&&(null==a?void 0:a.offset)){if(o.offset>a.offset)return 1;if(o.offset<a.offset)return -1}return 0}step(e){var t;let i=3===e.nodeType?"text":"element";return{id:null!==(t=e.id)&&void 0!==t?t:"",tagName:e.tagName,type:i,index:this.position(e)}}filteredStep(e,t){var i,n=this.filter(e,t);if(n)return i=3===n.nodeType?"text":"element",{id:n.id,tagName:n.tagName,type:i,index:this.filteredPosition(n,t)}}pathTo(e,t,i){let n={steps:[],terminal:{offset:null,assertion:null}};for(var r,s=e;s&&s.parentNode&&"EVO-HTML"!==s.tagName;)(r=i?this.filteredStep(s,i):this.step(s))&&n.steps.unshift(r),s=s.parentNode;return null!==t&&t>=0&&(n.terminal.offset=t,n.steps.length>0&&"text"!==n.steps[n.steps.length-1].type&&n.steps.push({type:"text",index:0,id:""})),n}equalStep(e,t){return!!e&&!!t&&e.index===t.index&&e.id===t.id&&e.type===t.type}parseFromRange(e,t,i){let n=e.startContainer,r=e.endContainer,s=e.startOffset,o=e.endOffset,a=!1;if(i){var l;a=(null===(l=n.ownerDocument)||void 0===l?void 0:l.querySelector("."+i))!==null}if(t.steps.length>1&&(this.spineIndex=this.baseParts.steps[1].index),e.collapsed)a&&(s=this.patchOffset(n,s,i)),this.path=this.pathTo(n,s,i);else{this.isRange=!0,a&&(s=this.patchOffset(n,s,i)),this.start=this.pathTo(n,s,i),a&&(o=this.patchOffset(r,o,i)),this.end=this.pathTo(r,o,i),this.path={steps:[],terminal:{offset:null,assertion:null}};var c,d=this.start.steps.length;for(c=0;c<d;c++)if(this.equalStep(this.start.steps[c],this.end.steps[c]))c===d-1?this.start.terminal===this.end.terminal&&(this.path.steps.push(this.start.steps[c]),this.isRange=!1):this.path.steps.push(this.start.steps[c]);else break;this.start.steps=this.start.steps.slice(this.path.steps.length),this.end.steps=this.end.steps.slice(this.path.steps.length)}return this}parseFromNode(e,t,i){return t.steps.length>1&&(this.spineIndex=this.baseParts.steps[1].index),this.path=this.pathTo(e,null,i),this}filter(e,t){var i,n,r,s,o,a,l=!1;return(3===e.nodeType?(l=!0,r=e.parentNode,i=null===(a=e.parentNode)||void 0===a?void 0:a.classList.contains(t)):(l=!1,i=e.classList.contains(t)),i&&l)?(s=r.previousSibling,o=r.nextSibling,s&&3===s.nodeType?n=s:o&&3===o.nodeType&&(n=o),n)?n:e:(!i||!!l)&&e}patchOffset(e,t,i){if(3!=e.nodeType)throw Error("Anchor must be a text node");var n=e,r=t;for(e.parentNode.classList.contains(i)&&(n=e.parentNode);n.previousSibling;){if(1===n.previousSibling.nodeType){if(n.previousSibling.classList.contains(i))r+=n.previousSibling.textContent.length;else break}else r+=n.previousSibling.textContent.length;n=n.previousSibling}return r}normalizedMap(e,t,i){var n,r,s,o={},a=-1,l=e.length;for(s=0;s<l;s++)1===(n=e[s].nodeType)&&e[s].classList.contains(i)&&(n=3),s>0&&3===n&&3===r?o[s]=a:t===n&&(a+=1,o[s]=a),r=n;return o}position(e){var t,i;return 1===e.nodeType?((t=e.parentNode.children)||(t=P(e.parentNode)),i=Array.prototype.indexOf.call(t,e)):i=(t=this.textNodes(e.parentNode)).indexOf(e),i}filteredPosition(e,t){var i,n;return 1===e.nodeType?(i=e.parentNode.children,n=this.normalizedMap(i,1,t)):(i=e.parentNode.childNodes,e.parentNode.classList.contains(t)&&(i=(e=e.parentNode).parentNode.childNodes),n=this.normalizedMap(i,3,t)),n[Array.prototype.indexOf.call(i,e)]}stepsToXpath(e){var t=[".","*"];return e.forEach(e=>{var i=e.index+1;e.id?t.push("*[position()="+i+" and @id='"+e.id+"']"):"text"===e.type?t.push("text()["+i+"]"):t.push("*["+i+"]")}),t.join("/")}stepsToQuerySelector(e){var t=["html"];return e.forEach(function(e){var i=e.index+1;e.id?t.push("#"+e.id):"text"===e.type||t.push("*:nth-child("+i+")")}),t.join(">")}textNodes(e,t){return Array.prototype.slice.call(e.childNodes).filter(function(e){return 3===e.nodeType||!!(t&&e.classList.contains(t))})}walkToNode(e,t,i){let n=t;var r,s,o=e.length;for(s=0;s<o&&("element"===(r=e[s]).type?n=P(n)[r.index]:"text"===r.type&&(n=this.textNodes(n,i)[r.index]),n);s++);return n}findNode(e,t,i){var n=t||document;return i?this.walkToNode(e,n,i):this.walkToNode(e,n)}fixMiss(e,t,i,n){var r,s,o=this.findNode(e.slice(0,-1),i,n),a=o.childNodes,l=this.normalizedMap(a,3,n),c=e[e.length-1].index;for(let e in l){if(!l.hasOwnProperty(e))return;if(l[e]===c){if(s=(r=a[e]).textContent.length,t>s)t-=s;else{o=1===r.nodeType?r.childNodes[0]:r;break}}}return{container:o,offset:t}}toRange(e){let t,i,n;let r=null,s=null,o=null,a=null;if(t=document.createRange(),this.isRange&&this.start&&this.end?(r=this.start,i=this.path.steps.concat(r.steps||[]),o=this.findNode(i,e),s=this.end,n=this.path.steps.concat(s.steps||[]),a=this.findNode(n,e)):(r=this.path,i=this.path.steps,o=this.findNode(this.path.steps,e)),!o)return null;try{null!==r.terminal.offset?t.setStart(o,r.terminal.offset):t.setStart(o,0)}catch(e){}if(a)try{(null==s?void 0:s.terminal.offset)!=null?t.setEnd(a,s.terminal.offset):t.setEnd(a,0)}catch(e){}return t}static isCfiString(e){return"string"==typeof e&&0===e.indexOf("epubcfi(")&&")"===e[e.length-1]}static generateChapterComponent(e,t,i){let n="/"+(e+1)*2+"/";return n+=(t+1)*2,i&&(n+="["+i+"]"),n}collapse(e){this.isRange&&(this.isRange=!1,e?(this.path.steps=this.path.steps.concat(this.start.steps),this.path.terminal=this.start.terminal):(this.path.steps=this.path.steps.concat(this.end.steps),this.path.terminal=this.end.terminal))}constructor(e,t,i){if(this.str="",this.baseParts={steps:[],terminal:{offset:null,assertion:null}},this.spineIndex=0,this.isRange=!1,this.path={steps:[],terminal:{offset:null,assertion:null}},this.start=null,this.end=null,!(this instanceof R))return new R(e,t,i);"string"==typeof t&&(this.baseParts=this.parseComponent(t));let n=this.checkType(e);if("string"===n)this.str=e,this.parse(e);else if("range"===n)this.parseFromRange(e,this.baseParts,i),this.str=this.toString();else if("node"===n)this.parseFromNode(e,this.baseParts,i),this.str=this.toString();else if(!e)return this;else throw TypeError("not a valid argument for EpubCFI")}}class _{parse(e,t){if(this.baseDir=m().dirname(t)+"/",!e)throw Error("Package File Not Found");let i=j(e,"metadata");if(!i)throw Error("No Metadata Found");let n=j(e,"manifest");if(!n)throw Error("No Manifest Found");let r=j(e,"spine");if(!r)throw Error("No Spine Found");this.parseManifest(n),this.parseMetadata(i),this.navPath=this.findNavPath(n),this.ncxPath=this.findNcxPath(n,r),this.coverPath=this.findCoverPath(e),this.spineNodeIndex=function(e,t){let i=e.parentNode,n=null==i?void 0:i.childNodes,r=-1;if(n){let t;for(let i=0;i<n.length&&(1===(t=n[i]).nodeType&&r++,t!==e);i++);}return r}(r,0),this.spine=this.parseSpine(r),this.uniqueIdentifier=_.findUniqueIdentifier(e)}parseManifest(e){let t=new Map,i=new Map;e.querySelectorAll("item").forEach(e=>{let n=e.getAttribute("id")||"",r=e.getAttribute("href")||"",s=e.getAttribute("media-type")||"",o=e.getAttribute("media-overlay")||"",a=e.getAttribute("properties")||"",l=m().join(this.baseDir,r),c={id:n,href:r,path:l,type:s,overlay:o,properties:a.length?a.split(" "):[]};n&&t.set(n,c),r&&i.set(r,c)}),this.manifest=t,this.manifestByHref=i}parseMetadata(e){this.metadata.title=_.getElementText(e,"title"),this.metadata.creator=_.getElementText(e,"creator"),this.metadata.description=_.getElementText(e,"description"),this.metadata.pubdate=_.getElementText(e,"date"),this.metadata.publisher=_.getElementText(e,"publisher"),this.metadata.identifier=_.getElementText(e,"identifier"),this.metadata.language=_.getElementText(e,"language"),this.metadata.rights=_.getElementText(e,"rights"),this.metadata.modified_date=_.getPropertyText(e,"dcterms:modified"),this.metadata.layout=_.getPropertyText(e,"rendition:layout"),this.metadata.orientation=_.getPropertyText(e,"rendition:orientation"),this.metadata.flow=_.getPropertyText(e,"rendition:flow"),this.metadata.viewport=_.getPropertyText(e,"rendition:viewport"),this.metadata.media_active_class=_.getPropertyText(e,"media:active-class"),this.metadata.spread=_.getPropertyText(e,"rendition:spread")}parseSpine(e){let t=[];return e.querySelectorAll("itemref").forEach((e,i)=>{var n,r,s,o,a,l,c;let d=null!==(s=e.getAttribute("properties"))&&void 0!==s?s:"",h=null!==(o=e.getAttribute("idref"))&&void 0!==o?o:"",u=null!==(a=null===(n=this.manifest.get(h))||void 0===n?void 0:n.href)&&void 0!==a?a:"",p=null!==(l=null===(r=this.manifest.get(h))||void 0===r?void 0:r.path)&&void 0!==l?l:"",f=R.generateChapterComponent(this.spineNodeIndex,i,h),g={id:null!==(c=e.getAttribute("id"))&&void 0!==c?c:"",idref:h,href:u,path:p,baseDir:this.baseDir,linear:e.getAttribute("linear")||"yes",properties:d.length?d.split(" "):[],index:i,cfiBase:f};t.push(g)}),t}static findUniqueIdentifier(e){let t=e.documentElement.getAttribute("unique-identifier");if(!t)return"";let i=e.getElementById(t);if(!i)return"";if("identifier"===i.localName&&"http://purl.org/dc/elements/1.1/"===i.namespaceURI){var n;return(null===(n=i.childNodes[0].nodeValue)||void 0===n?void 0:n.trim())||""}return""}findNavPath(e){var t;let i=N(e,"item",{properties:"nav"}),n="",r=null!==(t=null==i?void 0:i.getAttribute("href"))&&void 0!==t?t:"";return""!==r&&(n=m().join(this.baseDir,r)),n}findNcxPath(e,t){var i;let n,r=N(e,"item",{"media-type":"application/x-dtbncx+xml"});!r&&(n=t.getAttribute("toc"))&&(r=e.querySelector("#".concat(n)));let s="",o=null!==(i=null==r?void 0:r.getAttribute("href"))&&void 0!==i?i:"";return""!==o&&(s=m().join(this.baseDir,o)),s}findCoverPath(e){var t,i;let n="",r=N(e,"item",{properties:"cover-image"});if(r){let e=null!==(t=r.getAttribute("href"))&&void 0!==t?t:"";if(""!==e)return m().join(this.baseDir,e)}let s=N(e,"meta",{name:"cover"});if(s){let t=s.getAttribute("content"),r=e.getElementById(t),o=null!==(i=null==r?void 0:r.getAttribute("href"))&&void 0!==i?i:"";""!==o&&(n=m().join(this.baseDir,o))}return n}static getElementText(e,t){let i=e.getElementsByTagNameNS("http://purl.org/dc/elements/1.1/",t);if(!i||0===i.length)return"";let n=i[0];if(n.childNodes.length){let{nodeValue:e}=n.childNodes[0];if(e)return e}return""}static getPropertyText(e,t){let i=N(e,"meta",{property:t});return i&&i.childNodes.length?i.childNodes[0].nodeValue:""}constructor(){this.baseDir="",this.manifest=new Map,this.manifestByHref=new Map,this.metadata={title:"",creator:"",description:"",pubdate:"",publisher:"",identifier:"",language:"",rights:"",modified_date:"",layout:"",orientation:"",flow:"",viewport:"",media_active_class:"",spread:""},this.navPath="",this.ncxPath="",this.coverPath="",this.spineNodeIndex=0,this.spine=[],this.uniqueIdentifier=""}}class I{parse(e,t,i){this.baseDir=m().dirname(i)+"/",e.nodeType&&(t?this.toc=this.parseNav(e):this.toc=this.parseNcx(e)),this.length=0,this.unpack(this.toc)}unpack(e){let t;for(let i=0;i<e.length;i++)t=e[i],this.tocFlat.push(t),t.href&&(this.tocByHref[t.href]=i),t.id&&(this.tocById[t.id]=i),this.length+=1,t.children.length>0&&this.unpack(t.children)}get(e){let t;return e?(0===e.indexOf("#")?t=this.tocById[e.substring(1)]:e in this.tocByHref&&(t=this.tocByHref[e]),this.getByIndex(e,t,this.toc)):this.toc}parseNav(e){let t;let i=function(e,t,i){let n;if(void 0!==e.querySelector&&(n=e.querySelector("".concat(t,'[*|type="').concat(i,'"]'))),n&&0!==n.length)return n;n=S(e,t);for(let e=0;e<n.length;e++)if(n[e].getAttributeNS("http://www.idpf.org/2007/ops","type")===i||n[e].getAttribute("epub:type")===i)return n[e]}(e,"nav","toc"),n=i?S(i,"li"):[],r=n.length,s=new Map,o=[];if(!n||0===r)return o;for(let e=0;e<r;e++){let i=this.navItem(n[e]);i&&(s.set(i.id,i),i.parent?(t=s.get(i.parent))&&t.children.push(i):o.push(i))}return o}navItem(e){let t=e.getAttribute("id")||void 0,i=T(e,"a",!0);if(!i)return;let n=i.getAttribute("href")||"";t||(t=n);let r=i.textContent||"",s=E(e,"li"),o="";if(s&&!(o=s.getAttribute("id")||"")){let e=T(s,"a",!0);o=e&&e.getAttribute("href")||""}for(;!o&&s;)if((s=E(s,"li"))&&!(o=s.getAttribute("id")||"")){let e=T(s,"a",!0);o=e&&e.getAttribute("href")||""}return{id:t,path:m().join(this.baseDir,n),href:n,label:r,children:[],parent:o}}parseNcx(e){let t;let i=S(e,"navPoint"),n=i.length,r=new Map,s=[];if(!i||0===n)return s;for(let e=0;e<n;++e)t=this.ncxItem(i[e]),r.set(t.id,t),t.parent?r.get(t.parent).children.push(t):s.push(t);return s}ncxItem(e){var t,i,n,r;let s=e.getAttribute("id")||"",o=j(e,"content"),a=null!==(i=null==o?void 0:o.getAttribute("src"))&&void 0!==i?i:"",l=j(e,"navLabel"),c=null!==(n=null==l?void 0:null===(t=l.textContent)||void 0===t?void 0:t.trim())&&void 0!==n?n:"",d=e.parentNode,h="";return d&&("navPoint"===d.nodeName||"navPoint"===d.nodeName.split(":").slice(-1)[0])&&(h=null!==(r=d.getAttribute("id"))&&void 0!==r?r:""),{id:s,path:m().join(this.baseDir,a),href:a,label:c,children:[],parent:h}}load(e){return e.map(e=>(e.label=e.title,e.children=e.children?this.load(e.children):[],e))}forEach(e){return this.toc.forEach(e)}constructor(){this.baseDir="/",this.toc=[],this.tocFlat=[],this.tocByHref={},this.tocById={},this.landmarks=[],this.landmarksByType={},this.length=0}}class B{constructor(e,t,i){this.idref=e.idref,this.linear="yes"===e.linear,this.properties=e.properties,this.index=e.index,this.href=e.href,this.path=e.path,this.cfiBase=e.cfiBase,this.nextIndex=t,this.prevIndex=i}}class L{parse(e){this.opfSpine=e,this.length=e.length,e.forEach((t,i)=>{let n=-1,r=-1;if("yes"===t.linear){for(let t=i+1;t<e.length;t++)if("yes"===e[t].linear){n=t;break}for(let t=i-1;t>=0;t--)if("yes"===e[t].linear){r=t;break}}let s=new B(t,n,r);this.sectionItems.push(s),this.sectionItemsByPath[s.path]=s,this.sectionItemsByIdref[s.idref]=s,this.sectionItemsByCfibase[s.cfiBase]=s})}getSection(e){let t=0;if(void 0===e)for(;t<this.sectionItems.length;){let e=this.sectionItems[t];if(e&&e.linear)break;t+=1}else if("string"==typeof e&&R.isCfiString(e)){let t=R.extractCfi(e),i=R.getChapterComponent(t);return this.sectionItemsByCfibase[i]||null}else if("number"==typeof e)t=e;else if("string"==typeof e){var i;let n=e.split("#")[0];t=(null===(i=this.sectionItemsByPath[n])||void 0===i?void 0:i.index)||-1}return this.sectionItems[t]||null}constructor(){this.sectionItems=[],this.sectionItemsByPath={},this.sectionItemsByIdref={},this.sectionItemsByCfibase={},this.opfSpine=void 0,this.length=0}}class M{async parse(e,t){this.manifest=e,this.resources=Array.from(e.values()),this.html=this.resources.filter(e=>"application/xhtml+xml"===e.type||"text/html"===e.type),await Promise.all(Array.from(this.manifest.values()).map(async e=>{if("application/xhtml+xml"!==e.type&&"text/html"!==e.type){let i=await t.createUrl(e.path);this.assets.set(e.path,{...e,url:i})}if("text/css"===e.type){let i=await t.readEntry(e.path);this.css.set(e.path,{...e,text:i})}}))}constructor(){this.manifest=void 0,this.resources=[],this.html=[],this.assets=new Map,this.css=new Map,this.assetsUrls=[],this.cssUrls=[]}}let F="META-INF/container.xml";class D{async parse(e){try{await this.archive.open(e),await this.openContainer(),await this.openOpf(),this.resource.parse(this.opf.manifest,this.archive),await this.loadNavigation(),this.spine.parse(this.opf.spine)}catch(e){return Promise.reject(e)}return this}async openContainer(){let e=k(await this.archive.readEntry(F),F);this.container.parse(e)}async openOpf(){let e=this.container.opfPath,t=k(await this.archive.readEntry(e),e);this.opf.parse(t,e)}async loadNavigation(){let e=!0,t=this.opf.navPath;""===t&&(e=!1,t=this.opf.ncxPath);let i=k(await this.archive.readEntry(t),t);this.navigation.parse(i,e,t)}getSection(e){let t=this.spine.getSection(e);return t?(this.currentSectionIndex=t.index,t):null}async loadSection(e){let t=await this.archive.readEntry(e.path);return await this.parseHtmlContent(t,e.path)}async parseHtmlContent(e,t){let i=new DOMParser().parseFromString(e,"application/xhtml+xml");i.querySelectorAll("img").forEach(e=>{let i=e.getAttribute("src");if(!i)return;let n=m().join(t,"..",i),r=this.resource.assets.get(n),s=(null==r?void 0:r.url)||"";e.setAttribute("src",s)}),i.querySelectorAll("image").forEach(e=>{let i=e.getAttribute("xlink:href");if(!i)return;let n=m().join(t,"..",i),r=this.resource.assets.get(n),s=(null==r?void 0:r.url)||"";e.setAttribute("xlink:href",s)});let n=e=>{let i=e.getAttribute("href");if(!i||0===i.indexOf("mailto:")||0===i.indexOf("#"))return;if(i.indexOf("://")>-1){e.setAttribute("target","");return}let n=i.split("#")[1]||"",r=i.split("#")[0],s=m().join(t,"..",r),o=n?"".concat(s,"#").concat(n):s;e.setAttribute("href",o)};i.querySelectorAll("a[href]").forEach(e=>{n(e)});let r=[];i.querySelectorAll("link").forEach(e=>{let i=e.getAttribute("href");if(!i)return;let n=m().join(t,"..",i),s=this.resource.css.get(n);if(!s)return;let o=s.text.replace(/body/g,"evo-body"),a=o.match(/url\((.*?)\)/g);if(a)for(let e of a){let t=null==e?void 0:e.match(/url\((.*?)\)/);if(!t)continue;let i=t[1],r=m().join(n,"..",i),s=this.resource.assets.get(r),a=(null==s?void 0:s.url)||"";o=o.replace(i,a)}r.push(o)});let s=i.querySelector("body"),o="";if(s){let e=i.createElement("evo-body");e.innerHTML=s.innerHTML,o="<evo-head></evo-head>".concat(e.outerHTML)}return{htmlContent:b().sanitize(o,{ALLOW_UNKNOWN_PROTOCOLS:!0,ADD_TAGS:["evo-html","evo-head","evo-body"]}),cssList:r}}async openPath(e){return await this.archive.readEntry(e)}async openHref(e){let t=this.opf.manifestByHref.get(e);if(!t)throw Error("Invalid epub href");let i=t.path;return await this.archive.readEntry(i)}constructor(){this.archive=new y,this.container=new A,this.opf=new _,this.navigation=new I,this.resource=new M,this.spine=new L,this.currentSectionIndex=0}}var O=i(1969),U=i(4640);let z={id:"",metadata:{title:"",creator:"",description:"",pubdate:"",publisher:"",identifier:"",language:"",rights:"",modified_date:"",layout:"",orientation:"",flow:"",viewport:"",media_active_class:"",spread:""},currentSection:null,currentSectionIndex:0,firstSectionLoading:!0,moveToTarget:"",currentCfi:"",currentTocItem:null},Z=r.createContext({bookProps:z,setBookProps:()=>{},epubRef:{current:null}}),H=e=>{let{children:t}=e,i=r.useRef(null),[s,o]=(0,r.useState)(z),{readerProps:a,setReaderProps:l}=(0,r.useContext)(f),[c,h]=O.ZP.useNotification(),u=(0,r.useMemo)(()=>({bookProps:s,setBookProps:o,epubRef:i}),[s,o,i]),p=async e=>{let t=await d.lastReadTable.getLastReadRecord(e);if(t)return t;d.lastReadTable.setLastReadRecord({bookId:s.id,filePath:a.ebookPath,cfi:"",percent:0,createdAt:Date.now(),updatedAt:Date.now()},a.ebookPath)};return(0,r.useEffect)(()=>{a.ebookUrl&&(l(e=>({...e,isBookLoading:!0})),o(z),(async()=>{let e=new D,t=await fetch(a.ebookUrl).then(e=>e.blob());await e.parse(t).catch(e=>{throw c.error({message:"打开失败：".concat(a.ebookUrl),description:"".concat(e.stack)}),l(e=>({...e,isBookLoading:!1})),Error(e)}),i.current=e;let n=e.opf.metadata,r=a.ebookFileName+a.ebookSize+n.title+n.pubdate+n.identifier,s=(0,U.Z)(r,U.Z.URL),d=await p(a.ebookPath),h=(null==d?void 0:d.cfi)||"",u=0,f=e.getSection(0);return h&&(u=(null==(f=e.getSection(h))?void 0:f.index)||0),o(e=>({...e,id:s,metadata:n,currentSection:f,currentSectionIndex:u,moveToTarget:h})),l(e=>({...e,showSideBar:"toc",isBookLoading:!1}))})(),document.title=a.ebookFileName?a.ebookFileName+" - EvoReader":"EvoReader")},[c,a.ebookPath,a.ebookUrl,l]),(0,n.jsxs)(Z.Provider,{value:u,children:[h,t]})},q=r.createContext({isAnnotationListLoading:!0,setIsAnnotationListLoading:()=>{},annotationList:[],setAnnotationList:()=>{}}),W=e=>{let{children:t}=e,{bookProps:i}=(0,r.useContext)(Z),[s,o]=r.useState([]),[a,l]=r.useState(!0);(0,r.useEffect)(()=>{i.id&&(l(!0),(async()=>{let e=await d.annotationsTable.getAnnotationsByBookId(i.id);e&&e.length>0?o(e):o([]),l(!1)})())},[i.id]);let c=r.useMemo(()=>({isAnnotationListLoading:a,setIsAnnotationListLoading:l,annotationList:s,setAnnotationList:o}),[s,a]);return(0,n.jsx)(q.Provider,{value:c,children:t})};var X=i(2186),V=i(9718),Y=i(6320),G=i.n(Y),Q=e=>{let{mRef:t}=e,{readerProps:i,setReaderProps:s}=(0,r.useContext)(f),o=async e=>{if(e.target.files){i.ebookUrl&&URL.revokeObjectURL(i.ebookUrl);let t=e.target.files[0];if(!t)return;let n=URL.createObjectURL(t);s(e=>({...e,ebookUrl:n,ebookPath:t.name,ebookFileName:t.name,ebookSize:t.size}))}},a=async()=>{window.electronApi&&window.electronApi.ipcRenderer.sendMessage("IPCMAIN::ASK-OPEN-FILE")};return(0,n.jsx)(n.Fragment,{children:window.electronApi&&(0,n.jsx)("button",{ref:t,onClick:a,style:{display:"none"}})||(0,n.jsx)("input",{type:"file",accept:".epub",ref:t,onChange:o,style:{display:"none"}})})},J=i(3167),K=i(2175),$=i(4056),ee=i(4063),et=i(230),ei=i(7042),en=i(6768),er=i(4769);function es(){let e=(0,et._)(["",""]);return es=function(){return e},e}let eo=en.ZP.div(es(),e=>e.$cssText),ea=r.forwardRef((e,t)=>{let{className:i,orientation:r="horizontal",decorative:s=!0,...o}=e;return(0,n.jsx)(ee.f,{ref:t,decorative:s,orientation:r,className:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(0,er.m6)((0,ei.W)(t))}("shrink-0 bg-border","horizontal"===r?"h-[1px] w-full":"h-full w-[1px]",i),...o})});ea.displayName=ee.f.displayName;var el=i(3088),ec=i(4135),ed=e=>{let{}=e,{readerProps:t,setReaderProps:i}=(0,r.useContext)(f),s=t.settings.theme;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:G().icon,onClick:e=>{e.preventDefault(),i(e=>({...e,settings:{...e.settings,theme:"dark"===e.settings.theme?"light":"dark"}}))},children:"dark"===s?(0,n.jsx)(el.Z,{size:"1em"}):(0,n.jsx)(ec.Z,{size:"1em"})})})},eh=()=>{let{readerProps:e,setReaderProps:t}=(0,r.useContext)(f),i=(0,r.useRef)(null);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:G().ActivityBar,children:[(0,n.jsxs)("div",{className:G().icon,onClick:()=>{var e;return null===(e=i.current)||void 0===e?void 0:e.click()},children:[(0,n.jsx)(J.Z,{size:"1em"}),(0,n.jsx)(Q,{mRef:i})]}),(0,n.jsx)("div",{className:G().icon+("toc"===e.showSideBar?" "+G().active:""),onClick:e=>{e.preventDefault(),t(e=>({...e,showSideBar:"toc"===e.showSideBar?"":"toc"}))},children:(0,n.jsx)(X.Z,{})}),(0,n.jsx)("div",{className:G().icon+("style"===e.showSideBar?" "+G().active:""),onClick:e=>{e.preventDefault(),t(e=>({...e,showSideBar:"style"===e.showSideBar?"":"style"}))},children:(0,n.jsx)(V.Z,{})}),(0,n.jsx)("div",{className:G().icon+("annotation"===e.showSideBar?" "+G().active:""),onClick:e=>{e.preventDefault(),t(e=>({...e,showSideBar:"annotation"===e.showSideBar?"":"annotation"}))},children:(0,n.jsx)(K.Z,{size:"1em"})}),(0,n.jsx)(ea,{className:"mx-auto my-2 mt-auto w-4/5 bg-[#aaaaaa]"}),(0,n.jsx)(ed,{}),(0,n.jsx)("div",{className:G().icon+("about"===e.showSideBar?" "+G().active:""),onClick:e=>{e.preventDefault(),t(e=>({...e,showSideBar:"about"===e.showSideBar?"":"about"}))},children:(0,n.jsx)($.Z,{size:"1em"})})]})})},eu=i(2705),ep=i(5561),ef=i(8170),eg=i(2398),ev=i(2017),em=i(1210),ex=i(4899),eb=i.n(ex),ew=i(7303),ey=i.n(ew),ej=e=>{let{title:t="",children:i}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:ey().header,children:[(0,n.jsx)("div",{className:ey().title,children:t}),(0,n.jsx)("div",{className:ey().action,children:i})]})})};function eS(e){let{node:t,onClick:i}=e;return t.children&&0===t.children.length?(0,n.jsx)("span",{className:eb().arrow}):(0,n.jsx)("span",{className:eb().arrow,role:"presentation",onClick:i,children:t.isOpen?(0,n.jsx)(ef.Z,{}):(0,n.jsx)(eg.Z,{})})}function eN(e){let{node:t}=e,{readerProps:i,setReaderProps:s}=(0,r.useContext)(f),{bookProps:o,setBookProps:a,epubRef:l}=(0,r.useContext)(Z),c=e=>{var t;null===(t=o.handleMoveToTarget)||void 0===t||t.call(o,e),i.isMobile&&s(e=>({...e,showMobilePage:""}))};return(0,n.jsxs)("div",{role:"presentation",style:{marginLeft:15*t.level+"px"},className:eb().node,onClick:e=>{e.stopPropagation(),t.data.path&&c(t.data.path),t.isOpen||t.open()},children:[(0,n.jsx)(eS,{node:t,onClick:e=>{e.stopPropagation(),t.toggle()}}),(0,n.jsx)("span",{className:eb().label,title:t.data.label,children:t.data.label})]})}var eC=()=>{var e;let{bookProps:t,setBookProps:i,epubRef:s}=(0,r.useContext)(Z),[o,a]=(0,r.useState)(null),[l,c]=(0,r.useState)([]),[d,h]=(0,r.useState)(new Map),{ref:u,width:p,height:f}=(0,ep.Z)(),g=(0,r.useRef)(null);return(0,r.useEffect)(()=>{if(!s.current)return;let e=s.current;a(e.navigation.toc),c(e.navigation.tocFlat)},[s]),(0,r.useEffect)(()=>{if(t.firstSectionLoading)return;let e=l.filter(e=>{var i;return e.path.split("#")[0]===(null===(i=t.currentSection)||void 0===i?void 0:i.path)});if(0!==e.length&&(1===e.length&&i(t=>({...t,currentTocItem:e[0]})),e.length>1)){let i=new Map;e.forEach(e=>{var n;let r=e.href.split("#")[1],s=document.getElementById(r);if(!s)return;let o=new R(s,(null===(n=t.currentSection)||void 0===n?void 0:n.cfiBase)||"");i.set(e.id,o)}),h(i)}},[t.currentSection,l,t.firstSectionLoading]),(0,r.useEffect)(()=>{if(""===t.currentCfi||0===d.size)return;let e="",n=new R(t.currentCfi);for(let[t,i]of d){let r=R.compare(i,n);if(-1===r)e=t;else if(0===r){e=t;break}else if(1===r)break}let r=l.find(t=>t.id===e);r&&i(e=>({...e,currentTocItem:r}))},[t.currentCfi,d]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(ej,{title:"Table of Contents",children:[(0,n.jsx)(ev.Z,{onClick:()=>{var e;null===(e=g.current)||void 0===e||e.openAll()},style:{marginRight:"6px"}}),(0,n.jsx)(em.Z,{onClick:()=>{var e;null===(e=g.current)||void 0===e||e.closeAll()}})]}),o&&(0,n.jsx)("div",{ref:u,className:eb().container,children:(0,n.jsx)(eu.m,{ref:g,selection:null===(e=t.currentTocItem)||void 0===e?void 0:e.id,disableMultiSelection:!0,data:o,indent:20,height:f,width:"100%",onMove:()=>{},renderCursor:()=>null,children:eN})})]})},ek=i(7606),eT=i(2198),eE=i.n(eT),eP=i(8874);let{TextArea:eA}=ek.default;var eR=e=>{let{}=e,{readerProps:t,setReaderProps:i}=(0,r.useContext)(f),[s,o]=(0,r.useState)(t.settings.userContentStyle),{run:a}=(0,eP.Z)(e=>{i(t=>({...t,settings:{...t.settings,userContentStyle:e}}))},{wait:100});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ej,{title:"User Style"}),(0,n.jsx)("div",{className:eE().container,children:(0,n.jsx)(eA,{value:s,onChange:e=>{let t=e.target.value;o(t),a(t)},style:{height:"90vh"}})})]})},e_=i(2067),eI=i.n(e_),eB=e=>{let{annotationData:t,onClickAnnotation:i}=e,r=(null==t?void 0:t.createdAt)?eI()(t.createdAt).format("MMM DD, YYYY, HH:MM"):"null",s=(null==t?void 0:t.text)||"null",o=(null==t?void 0:t.tocLabel)||"null";return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"m-2 rounded-lg border transition-all hover:bg-accent cursor-pointer",onClick:()=>{(null==t?void 0:t.cfi)&&i(t.cfi)},children:[(0,n.jsx)("div",{className:"border-b flex justify-between items-center",children:(0,n.jsx)("div",{className:"pl-2",children:r})}),(0,n.jsx)("div",{className:"pt-2 pb-1 px-2",children:s}),(0,n.jsx)("div",{className:"ml-6 pb-2 pr-2 text-xs font-bold text-right text-ellipsis whitespace-nowrap overflow-hidden",children:o})]})})},eL=e=>{let{}=e,{isAnnotationListLoading:t,annotationList:i,setAnnotationList:s}=(0,r.useContext)(q),{bookProps:o}=(0,r.useContext)(Z),a=e=>{var t;null===(t=o.handleMoveToTarget)||void 0===t||t.call(o,e)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ej,{title:"Annotation"}),(0,n.jsx)("div",{className:"h-full overflow-auto select-none",children:i.map(e=>(0,n.jsx)(eB,{annotationData:e,onClickAnnotation:a},e.id))})]})},eM=e=>{let{}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ej,{title:"About EvoReader"}),(0,n.jsxs)("div",{className:"w-full overflow-auto",children:[(0,n.jsxs)("div",{className:"w-full whitespace-nowrap border-b p-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-bold",children:"Version: "}),(0,n.jsx)("span",{children:"v1.2.3-beta"})]}),(0,n.jsxs)("div",{className:"w-full overflow-hidden overflow-ellipsis",children:[(0,n.jsx)("span",{className:"font-bold",children:"Feedback: "}),(0,n.jsx)("a",{href:"https://github.com/EvoReader/EvoReader/issues",className:"text-blue-500",target:"_blank",children:"https://github.com/EvoReader/EvoReader"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-bold",children:"Author: "}),(0,n.jsx)("a",{href:"https://www.xianmin.org/",className:"text-blue-500",target:"_blank",children:"Xianmin"})]})]}),(0,n.jsxs)("div",{className:"p-2 w-full overflow-auto",children:[(0,n.jsx)("div",{className:"font-bold",children:"Change Log: "}),(0,n.jsx)("div",{className:"whitespace-pre-line mt-2",children:"## v1.2.3-beta (2024-02-07)\n- feat: a new About Panel, add CHANGELOG.md\n- global better .evoContent style, optimize mobile experience\n- fix bugs\n\n## v1.2.0-beta (2024-01-30)\n- feat: add Mobile UI, Better experience;\n- feat: add hotkeys, PageUp PageDown ArrowRight ArrowLeft;\n- use serwist to generate PWA app\n"})]})]})]})},eF=()=>{let{readerProps:e,setReaderProps:t}=(0,r.useContext)(f),[i,s]=r.useState(e.settings.sidebarWidth||300),{run:o}=(0,eP.Z)(e=>{t(t=>({...t,settings:{...t.settings,sidebarWidth:e}}))},{wait:100}),a=e=>{s(e),o(e)};return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:ey().sidebar+" bg-neutral-50 dark:bg-neutral-900",style:{width:"".concat(i,"px"),minWidth:"200px",maxWidth:"".concat(.45*window.innerWidth,"px")},children:["toc"===e.showSideBar&&!e.isBookLoading&&""!==e.ebookUrl&&(0,n.jsx)(eC,{}),"style"===e.showSideBar&&(0,n.jsx)(eR,{}),"annotation"===e.showSideBar&&(0,n.jsx)(eL,{}),"about"===e.showSideBar&&(0,n.jsx)(eM,{}),(0,n.jsx)("div",{onMouseDown:e=>{let n=e.clientX,r=e=>{let r=i+e.clientX-n;if(r<200){a(200),r<75&&t(e=>({...e,showSideBar:""}));return}if(r>.45*window.innerWidth){a(.45*window.innerWidth);return}a(r)},s=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",s),e.preventDefault()},className:ey().resizer,style:{left:"".concat(i-2,"px")}})]})})},eD=i(6715),eO=i(1773),eU=i(9722),ez=i.n(eU),eZ=i(251),eH=()=>{var e,t;let{t:i}=(0,eZ.$G)(),{bookProps:s,setBookProps:o,epubRef:a}=(0,r.useContext)(Z),l=null===(e=s.currentSection)||void 0===e?void 0:e.prevIndex,c=null===(t=s.currentSection)||void 0===t?void 0:t.nextIndex;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ea,{}),(0,n.jsxs)("div",{className:ez().footer+" bg-neutral-100 dark:bg-neutral-900",children:[(0,n.jsxs)("button",{onClick:()=>{if(s.handleMoveToTarget&&void 0!==l){var e;let t=null===(e=a.current)||void 0===e?void 0:e.getSection(l);t&&s.handleMoveToTarget(t)}},disabled:void 0===l||l<0,children:[(0,n.jsx)(eD.Z,{className:"mr-1"}),i("viewer.prev")]}),(0,n.jsx)(ea,{orientation:"vertical"}),(0,n.jsxs)("button",{onClick:()=>{if(s.handleMoveToTarget&&void 0!==c){var e;let t=null===(e=a.current)||void 0===e?void 0:e.getSection(c);t&&s.handleMoveToTarget(t)}},disabled:void 0===c||c<0,children:[i("viewer.next"),(0,n.jsx)(eO.Z,{className:"ml-1"})]})]})]})},eq=i(4324),eW=i.n(eq),eX=i(6548),eV=i.n(eX),eY=i(4007),eG=e=>{let{}=e,t=(0,r.useRef)(null);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"rounded-xl border-4 border-dashed border-black/5 bg-slate-50 dark:border-slate-500 dark:bg-slate-800/25",onClick:()=>{var e;return null===(e=t.current)||void 0===e?void 0:e.click()},children:[(0,n.jsxs)("div",{className:"flex cursor-pointer select-none flex-col items-center justify-center px-8 py-16 text-slate-500 dark:text-slate-100 sm:px-24",children:[(0,n.jsx)(eY.Z,{className:"text-6xl"}),(0,n.jsxs)("div",{className:eV().label,children:["拖拽文件进窗口 或 ",(0,n.jsx)("span",{style:{color:"#1b88ee"},children:"选择文件"})]}),(0,n.jsx)("div",{children:"支持 epub 格式"})]}),(0,n.jsx)(Q,{mRef:t})]})})},eQ=i(8463),eJ=i.n(eQ),eK=e=>{let{mRef:t,section:i}=e,{bookProps:s,setBookProps:o,epubRef:a}=(0,r.useContext)(Z),[l,c]=(0,r.useState)(""),[d,h]=(0,r.useState)(""),u=async()=>{try{let e=a.current;if(!e)return;let t=await e.loadSection(i);c(t.htmlContent),h(t.cssList.join("\n"))}catch(e){}};(0,r.useEffect)(()=>{if(a.current){if(s.currentSectionIndex===i.index&&s.firstSectionLoading){u().then(()=>{o(e=>({...e,firstSectionLoading:!1}))});return}s.firstSectionLoading||s.currentSectionIndex===i.index||u()}},[s.firstSectionLoading]);let p=(0,r.useMemo)(()=>(0,n.jsx)(eo,{$cssText:d,children:(0,n.jsx)("evo-html",{dangerouslySetInnerHTML:{__html:l},ref:t})}),[l,d]);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:eJ().content,style:{display:s.currentSectionIndex===i.index?"block":"none"},children:(0,n.jsx)("div",{className:"evo-content",children:p})})})},e$=i(4887),e0=i(92),e1=i.n(e0),e2=i(7137);class e3{page(e,t,i,n){if(e)return this.findStart(e,i,n)}walk(e,t){let i;let n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,{acceptNode:e=>e.nodeType===Node.TEXT_NODE||e.nodeType===Node.ELEMENT_NODE&&("img"===e.tagName.toLowerCase()||"image"===e.tagName.toLowerCase())?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}),r=n.nextNode();for(;r&&!(i=t(r));)r=n.nextNode();return i}findStart(e,t,i){let n,r;let s=[e],o=e=>{let n=function(e){let t;let i=e.ownerDocument;if(e.nodeType==Node.TEXT_NODE){let n=i.createRange();n.selectNodeContents(e),t=n.getBoundingClientRect()}else t=e.getBoundingClientRect();return t}(e),r=n.top,o=n.bottom;if(r>t&&r<i||o-20>t)return e;s.push(e)};for(;s.length;)if((n=s.shift())&&(r=this.walk(n,o))){if(r.nodeType===Node.TEXT_NODE)return this.findTextStartRange(r,t,i)||r;return r}}findTextStartRange(e,t,i){let n;let r=this.splitTextNodeIntoRanges(e);for(let e=0;e<r.length;e++)if((n=r[e]).getBoundingClientRect().top>t)return n.collapse(!0),n}splitTextNodeIntoRanges(e){let t;let i=[],n=(e.textContent||"").trim(),r=e.ownerDocument;for(let s=0;s<n.length;s++)(t=r.createRange()).setStart(e,s),t.setEnd(e,s+1),i.push(t),t=!1;return i}rangePairToCfiPair(e,t){let i=t.start,n=t.end;return i.collapse(!0),n.collapse(!1),{start:i,end:n}}rangeListToCfiList(e,t){let i=[];for(let n=0;n<t.length;n++)i.push(this.rangePairToCfiPair(e,t[n]));return i}axis(e){return e&&(this.isHorizontal="horizontal"===e),this.isHorizontal}constructor(e,t,i){this.isHorizontal=!1,this.direction="ltr",this.isDev=!1,this.isHorizontal="horizontal"===t,this.direction=e||"ltr",this.isDev=i||!1}}var e5=i(3636),e4=i(5150),e6=function(e){let[t,i]=(0,r.useState)(null),n=(0,r.useRef)(t),s=(0,r.useRef)(!1);return n.current=t,(0,e5.Z)(()=>{let t=(0,e4.getTargetElement)(e,document);if(!t)return;let r=()=>{let e=null;window.getSelection&&((e=window.getSelection())?e.toString():"")&&s.current&&i(e)},o=e=>{if(2===e.button||!window.getSelection)return;n.current&&i(null),s.current=!1;let r=window.getSelection();r&&(r.removeAllRanges(),s.current=t.contains(e.target))};return t.addEventListener("mouseup",r),document.addEventListener("mousedown",o),()=>{t.removeEventListener("mouseup",r),document.removeEventListener("mousedown",o)}},[],e),t},e8=i(7998),e7=i(4021),e9=i(1552),te=i(846),tt=i(7322),ti=i(5618),tn=e=>{let{position:t,onClick:i}=e;if(!t)return(0,n.jsx)(n.Fragment,{});let{boundingRect:r,rects:s}=t;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"EvoAnnotation__parts",onClick:i,children:s.map((e,t)=>(0,n.jsx)("div",{style:{...e},className:"EvoAnnotation__part"},t))})})},tr=e=>{let{sectionElement:t,viewerRef:i,showAnnotatorByClick:s}=e,{bookProps:o}=(0,r.useContext)(Z),{isAnnotationListLoading:a,annotationList:l}=(0,r.useContext)(q),{width:c}=(0,ep.Z)({ref:i}),d=function(e){var t,n,r;arguments.length>1&&void 0!==arguments[1]&&arguments[1];let s=null===(t=i.current)||void 0===t?void 0:t.getBoundingClientRect(),o=(null===(n=i.current)||void 0===n?void 0:n.scrollTop)||0,a=(null===(r=i.current)||void 0===r?void 0:r.scrollLeft)||0;if(!s)return[];let l=Array.from(e.getClientRects()),c=[];for(let e of l){let t={top:e.top+o-s.top,left:e.left+a-s.left,width:e.width,height:e.height};c.push(t)}return c},h=e=>{if(!t||!o.currentSection)return;let i=new R(e,o.currentSection.cfiBase||"").toRange(t);if(!i)return;let n=d(i);return{boundingRect:i.getBoundingClientRect(),rects:n}};if(a||!o.currentSection)return(0,n.jsx)(n.Fragment,{});let u=l.filter(e=>e.sectionIndex===o.currentSectionIndex);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"EvoAnnotation",children:u.map(e=>(0,n.jsx)(tn,{position:h(e.cfi),onClick:t=>{if(!s)return;let i=h(e.cfi);i&&s(t,i.boundingRect,e)},onMouseOver:()=>{},onMouseOut:()=>{}},e.id))},c)})};i(9046);var ts=e=>{let{viewerRef:t,sectionElement:i}=e,{bookProps:s,setBookProps:o}=(0,r.useContext)(Z),{annotationList:a,setAnnotationList:l}=(0,r.useContext)(q),c=(0,r.useRef)(null),[h,u]=r.useState(""),[p,f]=r.useState(),g=(e,i,n)=>{var r,s,o;let a=null===(r=t.current)||void 0===r?void 0:r.getBoundingClientRect(),l=(null==a?void 0:a.right)||window.innerWidth,d=(null==a?void 0:a.height)||window.innerHeight,h=(null===(s=c.current)||void 0===s?void 0:s.clientWidth)||90,u=(null===(o=c.current)||void 0===o?void 0:o.clientHeight)||60,p=e.bottom+5,f=i-h/2;return f<0&&(f=i),f+h>l&&(f=l-h),e.bottom-n>n-e.top+20?e.top>u?p=e.top-u-5:d-e.bottom>u||(p=n+5):d-e.bottom>u||(p=e.top>u?e.top-u:n-u),{top:p,left:f}},v=e6(t.current),[m,x]=r.useState(),[b,w]=r.useState();(0,r.useEffect)(()=>{h||(x(void 0),w(void 0))},[h]);let y=async()=>{var e;if(!m||!b)return;let t={id:(0,ti.Z)(),bookId:s.id,cfi:m,bookTitle:s.metadata.title,sectionIndex:s.currentSectionIndex,tocLabel:(null===(e=s.currentTocItem)||void 0===e?void 0:e.label)||"",createdAt:Date.now(),updatedAt:Date.now(),type:"highlight",color:"rgba(255, 226, 143, 1)",text:b};return l(e=>[...e,t]),d.annotationsTable.addAnnotation(t),t};(0,te.Z)("mouseup",e=>{var t;if(!v||v.isCollapsed)return;let i=v.getRangeAt(0),n=g(i.getBoundingClientRect(),e.clientX,e.clientY),r=i.toString(),o=null===(t=s.currentSection)||void 0===t?void 0:t.cfiBase;o&&(x(new R(i,o).toString()),w(r),f(n),u("bySelect"))},{target:t.current}),(0,te.Z)("mousedown",()=>{u("")},{target:t.current}),(0,te.Z)("scroll",()=>{if(h){u("");let e=window.getSelection();e&&e.removeAllRanges()}},{target:t.current});let[j,S]=r.useState(),N=(e,t,i)=>{e.stopPropagation();let n=g(t,e.clientX,e.clientY);x(i.cfi),w(i.text),S(i.id),f(n),u("byClick")},C=async()=>{j&&(l(a.filter(e=>e.id!==j)),await d.annotationsTable.deleteAnnotation(j),S(void 0))};return(0,r.useEffect)(()=>{o(e=>({...e,showAnnotatorByClick:N}))},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"EvoAnnotator",ref:c,style:{visibility:""!==h?"visible":"hidden",...p},children:[(0,n.jsx)("div",{className:"EvoAnnotator__icon",style:{display:"bySelect"===h?"block":"none"},onMouseDown:e=>{u(""),y()},children:(0,n.jsx)(e8.Z,{})}),(0,n.jsx)("div",{className:"EvoAnnotator__icon",style:{display:"byClick"===h?"block":"none"},onMouseDown:e=>{e.stopPropagation(),C(),u("")},children:(0,n.jsx)(e7.Z,{})}),(0,n.jsx)("div",{className:"EvoAnnotator__icon",children:(0,n.jsx)(e9.Z,{onMouseDown:e=>{e.stopPropagation(),b&&(navigator.clipboard.writeText(b).then(()=>{tt.ZP.success("复制成功！")}).catch(()=>{tt.ZP.error("复制失败，请重试！")}),u(""))}})})]}),i&&(0,n.jsx)(tr,{showAnnotatorByClick:N,viewerRef:t,sectionElement:i})]})},to=e=>{let{children:t,open:i=!0,style:s}=e,{readerProps:o,setReaderProps:a}=(0,r.useContext)(f);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"fixed top-0 z-10 h-full w-full",style:{display:i?"block":"none",...s},onClick:e=>{e.stopPropagation(),a(e=>({...e,showMobilePage:""}))},onTouchStart:e=>{e.stopPropagation(),a(e=>({...e,showMobilePage:""}))},children:t})})},ta=e=>{let{}=e,{readerProps:t,setReaderProps:i}=(0,r.useContext)(f);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"h-full bg-neutral-50 dark:bg-neutral-900",style:{display:""!==t.showMobilePage&&"empty"!==t.showMobilePage?"block":"none"},onClick:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()},children:["toc"===t.showMobilePage&&(0,n.jsx)(eC,{}),"style"===t.showMobilePage&&(0,n.jsx)(eR,{}),"annotation"===t.showMobilePage&&(0,n.jsx)(eL,{}),"about"===t.showMobilePage&&(0,n.jsx)(eM,{})]})})},tl=i(491),tc=i.n(tl),td=e=>{let{children:t,open:i=!0}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:tc().header,style:{display:i?"block":"none"},onClick:e=>{e.stopPropagation()},onTouchStart:e=>{e.stopPropagation()},children:t})})},th=e=>{let{}=e,{readerProps:t,setReaderProps:i}=(0,r.useContext)(f),s=(0,r.useRef)(null);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(td,{children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsxs)("div",{className:tc().icon,onClick:()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.click()},children:[(0,n.jsx)(J.Z,{size:"1em"}),(0,n.jsx)(Q,{mRef:s})]}),(0,n.jsx)("div",{className:"ml-auto"}),(0,n.jsx)("div",{className:tc().icon+("style"===t.showMobilePage?" "+tc().active:""),onClick:e=>{e.preventDefault(),i(e=>({...e,showMobilePage:"empty"===e.showMobilePage?"style":"empty"}))},children:(0,n.jsx)(V.Z,{})}),(0,n.jsx)("div",{className:tc().icon+("annotation"===t.showMobilePage?" "+tc().active:""),onClick:e=>{e.preventDefault(),i(e=>({...e,showMobilePage:"empty"===e.showMobilePage?"annotation":"empty"}))},children:(0,n.jsx)(K.Z,{size:"1em"})}),(0,n.jsx)("div",{className:tc().icon+("toc"===t.showMobilePage?" "+tc().active:""),onClick:e=>{e.preventDefault(),i(e=>({...e,showMobilePage:"empty"===e.showMobilePage?"toc":"empty"}))},children:(0,n.jsx)(X.Z,{})}),(0,n.jsx)(ed,{})]})})})},tu=i(9299),tp=e=>{var t;let{}=e,{readerProps:i,setReaderProps:s}=(0,r.useContext)(f),{bookProps:o,setBookProps:a,epubRef:l}=(0,r.useContext)(Z),c=(0,r.useRef)(null),h=(0,r.useRef)(new Map);function u(){return h.current||(h.current=new Map),h.current}function p(e){return u().get(e)}function g(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];(0,e$.flushSync)(()=>{a(t=>({...t,currentSection:e,currentSectionIndex:e.index}))});let i=p(e.index);i&&i.scrollIntoView({block:t?"start":"end"})}function v(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=null===(e=o.currentSection)||void 0===e?void 0:e.prevIndex;if(void 0!==n){let e=null===(t=l.current)||void 0===t?void 0:t.getSection(n);if(!e)return;g(e,i)}}function m(){var e,t;let i=null===(e=o.currentSection)||void 0===e?void 0:e.nextIndex;if(void 0!==i){let e=null===(t=l.current)||void 0===t?void 0:t.getSection(i);if(!e)return;g(e)}}function x(e,t){let i=p(e);if(!i)return!1;let n=i.querySelector('[id="'.concat(t.slice(1),'"]'));return!!n&&(n.scrollIntoView({block:"start"}),!0)}let b=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(e instanceof B){g(e,t);return}e.startsWith("#")?x(o.currentSectionIndex,e):R.isCfiString(e)?function(e){var t,i,n;let r=null===(t=l.current)||void 0===t?void 0:t.getSection(e);if(!r)return;(0,e$.flushSync)(()=>{a(e=>({...e,currentSection:r,currentSectionIndex:r.index}))});let s=p(r.index);if(!s)return;let o=new R(e).toRange(s),d=null==o?void 0:o.getBoundingClientRect();if((null==d?void 0:d.height)===0)(null==o?void 0:o.startContainer)instanceof HTMLElement&&(null==o||o.startContainer.scrollIntoView({block:"start"}));else{let e=(null===(i=c.current)||void 0===i?void 0:i.scrollTop)||0,t=(null==d?void 0:d.top)||0;null===(n=c.current)||void 0===n||n.scrollTo({top:e+t})}}(e):function(e){var t;let i=null===(t=l.current)||void 0===t?void 0:t.getSection(e);if(!i)return;(0,e$.flushSync)(()=>{a(e=>({...e,currentSection:i,currentSectionIndex:i.index}))});let n=e.indexOf("#");if(n>-1){let t=e.slice(n);x(i.index,t)||g(i)}else g(i)}(e)},{run:w}=(0,e2.Z)(()=>{!function(){let e=p(o.currentSectionIndex),t=o.currentSection;if(!e||!(null==t?void 0:t.cfiBase))return;let n=new e3().findStart(e,0,window.innerHeight);if(!n)return;let r=new R(n,null==t?void 0:t.cfiBase).toString();a(e=>({...e,currentCfi:r}));let s={bookId:o.id,filePath:i.ebookPath,cfi:r,percent:0,updatedAt:Date.now()};d.lastReadTable.setLastReadRecord(s,i.ebookPath)}()},{wait:200}),[y,j]=r.useState(0),S=(0,r.useRef)(null);function N(){let e=c.current;if(!e)return;let t=e.clientHeight;e.scrollHeight-e.scrollTop-t<5?m():e.scrollBy({top:t-20})}function C(){let e=c.current;if(!e)return;let t=e.clientHeight;0===e.scrollTop?v():e.scrollBy({top:-t+20})}(0,r.useEffect)(()=>{o.firstSectionLoading||(b(o.moveToTarget),a(e=>({...e,handleMoveToTarget:b})))},[o.firstSectionLoading]);let k=(0,r.useRef)(!1),T={keydown:!0,keyup:!1,preventDefault:!0};return(0,tu.y1)("PageDown",N,T),(0,tu.y1)("PageUp",C,T),(0,tu.y1)("ArrowDown",function(){let e=c.current;if(!e)return;let t=e.clientHeight;e.scrollHeight-e.scrollTop-t<5?m():e.scrollBy({top:100})},T),(0,tu.y1)("ArrowUp",function(){let e=c.current;e&&(0===e.scrollTop?v():e.scrollBy({top:-100}))},T),(0,tu.y1)("ArrowLeft",()=>{v(!0)},T),(0,tu.y1)("ArrowRight",m,T),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{id:"evo-viewer",className:e1().viewer+" h-full w-full",style:{scrollbarWidth:i.isMobile?"none":"auto"},ref:c,onScroll:w,onWheel:e=>{var t,i,n,r;if(S.current&&clearTimeout(S.current),c.current){if(0===c.current.scrollTop&&e.deltaY<0&&(j(e=>e-10),y<=-100)){j(0);let e=null===(i=l.current)||void 0===i?void 0:i.getSection(null===(t=o.currentSection)||void 0===t?void 0:t.prevIndex);if(!e)return;g(e,!1)}if(c.current.scrollHeight-c.current.offsetHeight-c.current.scrollTop<3&&e.deltaY>0&&(j(e=>e+10),y>=100)){j(0);let e=null===(r=l.current)||void 0===r?void 0:r.getSection(null===(n=o.currentSection)||void 0===n?void 0:n.nextIndex);if(!e)return;g(e)}S.current=setTimeout(()=>{j(0)},300)}},onClick:e=>{var t;let n=e.target.closest("a[href]");if(n){e.preventDefault();let t=n.getAttribute("href");if(t){t.startsWith("http")?window.open(t,"_blank"):b(t);return}}let r=c.current;if(!r)return;if(!(null===(t=window.getSelection())||void 0===t?void 0:t.isCollapsed)){k.current=!0;return}if(k.current){k.current=!1;return}let o=r.getBoundingClientRect(),a=e.clientX-o.left,l=o.width/3;a<l?C():a<2*l?i.isMobile&&s(e=>({...e,showMobilePage:"empty"})):N()},children:[i.isMobile&&(0,n.jsxs)(to,{open:""!==i.showMobilePage,children:[(0,n.jsx)(th,{}),(0,n.jsx)(ta,{})]}),(0,n.jsxs)("div",{className:"relative h-auto min-h-full",children:[(0,n.jsx)("div",{className:"absolute top-0 h-2 w-full",children:(0,n.jsx)("div",{style:{width:"".concat(-y,"%")},className:"h-full bg-blue-500"})}),(0,n.jsx)(eo,{$cssText:i.settings.userContentStyle||"",children:(0,n.jsx)("div",{id:"evo-content",className:e1().evoContent+" prose mx-auto dark:prose-invert",children:null===(t=l.current)||void 0===t?void 0:t.spine.sectionItems.map(e=>(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(eK,{mRef:t=>{let i=u();t?i.set(e.index,t):i.delete(e.index)},section:e},e.index)}))})}),(0,n.jsx)("div",{className:"absolute bottom-0 mt-auto h-2 w-full",children:(0,n.jsx)("div",{style:{width:"".concat(y,"%")},className:"h-full bg-blue-500"})})]}),(0,n.jsx)(ts,{viewerRef:c,sectionElement:p(o.currentSectionIndex)})]})})},tf=e=>{let{}=e,{readerProps:t,setReaderProps:i}=(0,r.useContext)(f);return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(td,{children:(0,n.jsxs)("div",{className:"flex",children:[(0,n.jsx)("div",{className:"ml-auto"}),(0,n.jsx)(ed,{}),(0,n.jsx)("div",{className:tc().icon+("about"===t.showMobilePage?" "+tc().active:""),onClick:e=>{e.preventDefault(),i(e=>({...e,showMobilePage:""===e.showMobilePage?"about":""}))},children:(0,n.jsx)($.Z,{size:"1em"})})]})})})},tg=()=>{let{readerProps:e,setReaderProps:t}=(0,r.useContext)(f);return(0,r.useEffect)(()=>{let i=e=>{e.preventDefault(),document.body.classList.add(".is-dragging")},n=e=>{e.preventDefault(),document.body.classList.add(".is-dragging")},r=e=>{e.preventDefault(),document.body.classList.remove(".is-dragging")},s=i=>{var n;i.preventDefault();let r=null===(n=i.dataTransfer)||void 0===n?void 0:n.files;if(r&&r.length>0){let i=r[0];if(!i)return;if(e.ebookUrl&&URL.revokeObjectURL(e.ebookUrl),"application/epub"!==i.type){alert("Only epub files are supported.");return}let n=URL.createObjectURL(i);t(e=>({...e,ebookUrl:n,ebookPath:i.name,ebookFileName:i.name,ebookSize:i.size}))}};return window.addEventListener("dragenter",n),window.addEventListener("dragleave",r),window.addEventListener("dragover",i),window.addEventListener("drop",s),()=>{window.removeEventListener("dragenter",n),window.removeEventListener("dragleave",r),window.removeEventListener("dragover",i),window.removeEventListener("drop",s)}},[]),(0,r.useEffect)(()=>{t(e=>({...e,isMobile:window.innerWidth<=800}));let e=()=>{window.innerWidth<=800?t(e=>({...e,isMobile:!0})):t(e=>({...e,isMobile:!1}))};return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:eW().reader+" dark:bg-neutral-800",children:[e.isMobile&&(0,n.jsx)(()=>(0,n.jsx)(n.Fragment,{children:""===e.ebookUrl&&(0,n.jsxs)(to,{style:{height:""===e.showMobilePage?"auto":"100%"},children:[(0,n.jsx)(tf,{}),(0,n.jsx)(ta,{})]})}),{})||(0,n.jsx)(()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eh,{}),""!==e.showSideBar&&(0,n.jsx)(eF,{})]}),{}),!e.isBookLoading&&""===e.ebookUrl&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:"w-full",children:(0,n.jsx)("div",{className:"mx-6 flex h-full",children:(0,n.jsxs)("div",{className:"m-auto",children:[(0,n.jsxs)("div",{className:"flex items-center text-5xl sm:text-6xl",children:[(0,n.jsx)("img",{src:"./icon.png",alt:"evo-reader",width:"64px",className:"mr-2"}),"EvoReader"]}),(0,n.jsx)("div",{className:"mt-6 max-w-2xl",children:(0,n.jsx)(eG,{})})]})})})}),!e.isBookLoading&&""!==e.ebookUrl&&(0,n.jsxs)("div",{className:"w-full",children:[(0,n.jsx)(tp,{}),(0,n.jsx)(eH,{})]})]})})},tv=i(3968),tm=JSON.parse('{"viewer":{"prev":"Previous","next":"Next"}}'),tx=JSON.parse('{"viewer":{"prev":"上一章","next":"下一章"}}');function tb(){return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(g,{children:(0,n.jsx)(H,{children:(0,n.jsx)(W,{children:(0,n.jsx)(tg,{})})})})})}tv.ZP.use(eZ.Db).init({lng:"zh_CN",debug:!0,resources:{en:{translation:tm},zh_CN:{translation:tx}}})},9046:function(){},6320:function(e){e.exports={ActivityBar:"ActivityBar_ActivityBar__a39dO",icon:"ActivityBar_icon__ThGmC",active:"ActivityBar_active__ahhjF"}},6548:function(e){e.exports={box:"DropFileBox_box__c1WP_",label:"DropFileBox_label___XQ_F"}},491:function(e){e.exports={header:"MobileHeader_header__Et3D7",icon:"MobileHeader_icon__fdpwR",active:"MobileHeader_active__JAh_X"}},4324:function(e){e.exports={reader:"Reader_reader__VQF9J"}},7303:function(e){e.exports={sidebar:"SideBar_sidebar__Xzm7R",header:"SideBar_header___y4sB",title:"SideBar_title__aj588",resizer:"SideBar_resizer__OZ5j0"}},4899:function(e){e.exports={container:"Toc_container__onqy6",node:"Toc_node__EAsE6",arrow:"Toc_arrow__Y2H75",label:"Toc_label__YfigH"}},2198:function(e){e.exports={container:"UserStyle_container__DFSW7"}},9722:function(e){e.exports={footer:"ViewerFooter_footer__HYRq4"}},8463:function(e){e.exports={content:"EpubSection_content__lPCTR"}},92:function(e){e.exports={viewer:"EpubViewer_viewer__jZxew",contentWrapper:"EpubViewer_contentWrapper__E1wAv",evoContent:"EpubViewer_evoContent___K4UR"}}},function(e){e.O(0,[990,318,971,752,744],function(){return e(e.s=2359)}),_N_E=e.O()}]);